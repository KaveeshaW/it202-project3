<!DOCTYPE html>
<html lang = "en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>project3</title>
</head>
<body>
    <canvas id="canvas-demo" width="400" height="400">
         This will be displayed if your browser doesn't
         support the canvas element. The closing tag is
         necessary.
    </canvas>
    <script>
      const demoCanvas = document.getElementById('canvas-demo').getContext('2d');
      
      const notContextCanvas = document.getElementById('canvas-demo');
      
      let player = {x:100, y:300, radius: 50, color: "blue", lives: 3};
      let enemy = {x:100, y: 100, radius: 25, color: "red", speed: 4, name: "enemy"};
      let benefit = {x: 100, y: 200, radius: 30, color: "green", speed: 2, name: "benefit"};
      //water marks, 


      //event handlers change the values
      document.addEventListener("keydown", (e) => {
        if(e.key == " ") {
          draw();
        }
      });
      

      document.addEventListener("keydown", (e) => {
        if(e.key == "ArrowUp") {
          player["y"] -= 30;
        }
        if(e.key == "ArrowDown") {
          player["y"] += 30;
        }
      });
      
      const start = () => {
        demoCanvas.beginPath();
        demoCanvas.fillStyle = "green";
        demoCanvas.font = "20px Times New Roman";
        demoCanvas.fillText("Welcome to Tom and Jerry Simulator!", 50, 200, 400);
        demoCanvas.fillText("Press the space bar to play!", 90, 210, 400);
        demoCanvas.closePath();
      }

      const end = () => {
        demoCanvas.clearRect(0, 0, notContextCanvas.width, notContextCanvas.height);
        //demoCanvas.beginPath();        
        demoCanvas.fillStyle = "green";
        demoCanvas.font = "20px Times New Roman";
        demoCanvas.fillText("Game over! Thanks for playing", 50, 200, 400);
        //demoCanvas.closePath();
      }
      
      const drawObject = (object) => {
        demoCanvas.beginPath();
        demoCanvas.arc(object["x"], object["y"], object["radius"], 0, Math.PI*2);
        demoCanvas.fillStyle = object.color;
        demoCanvas.fill();
        demoCanvas.closePath();
      }
      
      const reposition = (object) => {
        if(object["x"] >= notContextCanvas.width  + object["radius"]) {
          object["x"] = -object["radius"];
        }
      }
      
      //other is either the benefit or the harm character
      const hitDetection = (player, other) => {
        var dx = player.x - other.x;
        var dy = player.y - other.y;
        var distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < player.radius + other.radius) {
            if(other.name === "enemy") {
              player.lives -= 1;
            }
            if(other.name === "benefit") {
              player.lives += 1;  
            }
            other.y = Math.floor(Math.random() * notContextCanvas.height);
            other.x = notContextCanvas.width - 50;
        }
      }
      
      const drawLives = () => {
        demoCanvas.beginPath();
        demoCanvas.fillStyle = "pink";
        demoCanvas.font = "30px Times New Roman";
        demoCanvas.fillText("Player Lives: " + player.lives, 30, 40, 300);
        demoCanvas.closePath();
      }
      
      //clears the canvas
      //updates enemy and player characters
      const updateCanvas = () => {
        demoCanvas.clearRect(0, 0, notContextCanvas.width, notContextCanvas.height);

        enemy["x"] += enemy.speed;
        benefit["x"] += benefit.speed;
      }

      //score mod 100, game level property
      //level and speed, based on time, score
      const draw = () => {
        updateCanvas();

        reposition(enemy);
        reposition(benefit);

//         demoCanvas.beginPath();
//         let dogImg = new Image();
//         dogImg.src = "https://images.pexels.com/photos/1108099/pexels-photo-1108099.jpeg?cs=srgb&dl=two-yellow-labrador-retriever-puppies-1108099.jpg&fm=jpg";

//         //image object that you want to draw
//         //pasting it at a certain x and y coordinate
//         demoCanvas.drawImage(dogImg, 100, 100);
//         demoCanvas.endPath();

        drawObject(player);
        drawObject(enemy);
        drawObject(benefit);

        hitDetection(player, enemy);
        hitDetection(player, benefit);

        if(player.lives === 0) {
          end();
          return;
        }  

        drawLives();
        
        window.requestAnimationFrame(draw);
      }
      //use functions here
      start();
      
    </script>
</body>
</html>