<!DOCTYPE html>
<html lang = "en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>project3</title>
</head>
<body>
    <canvas id="canvas-demo" width="1500%" height="600%" style = "background: url(tomJerry.jpg); background-size: 100% 100%;">
         This will be displayed if your browser doesn't
         support the canvas element. The closing tag is
         necessary.
    </canvas>
    <script>
      const canvas = document.getElementById('canvas-demo');
      const ctx = canvas.getContext('2d');
      
      //----------------------------
      //creating different images
      //the enemy image
      let spike = new Image();
      spike.src = "spike.jpg";
      
      //the benefit image
      let tom = new Image();
      tom.src = "tom.jpg";
      
      let black_cat = new Image();
      black_cat.src = "black_cat.jpg";
      //----------------------------
      
      let level = 1;
      let howManyTimeSpaceUsed = 0;
      let baseThreshold = 2;
      let player = {x:100, y:300, radius: 29, color: "blue", lives: 3, score: 0, name: "player", width: 80, height: 80};
      let enemy = {x:100, y: 100, radius: 48, color: "red", speed: 7, name: "enemy", width: 110, height: 110};
      let benefit = {x: 100, y: 200, radius: 39, color: "green", speed: 5, name: "benefit", width: 100, height: 100};
 
      //event handlers change the values
      //added a howManyTimeSpaceUsed variable so you can only press space once, before you could press space a bunch of times leading
      //to weird results
      document.addEventListener("keydown", (e) => {
        if(e.key === " " && howManyTimeSpaceUsed === 0) {
          draw();
          howManyTimeSpaceUsed++;
        }
      });
      
      //used keydown because I wanted to track user press and hold, not just press, which would be key up
      document.addEventListener("keydown", (e) => {
        if(e.key == "ArrowUp") {
          player["y"] -= 30;
        }
        if(e.key == "ArrowDown") {
          player["y"] += 30;
        }
      });
      
      const start = () => {                
        ctx.beginPath();  
        //let spike = new Image();
        ctx.fillStyle = "black";
        ctx.font = "40px Times New Roman";
        ctx.fillText("Welcome to the Tom and Jerry Simulator!", 825, 100);
        ctx.font = "20px Times New Roman";
        ctx.fillText("Press the space bar to play!", 825, 125);
        ctx.fillText("Move the blue player up and down!", 825, 150);
        ctx.fillText("Try to hit the green circle to gain points!", 825, 175);
        ctx.fillText("Avoid the red circle, it will lower your life counter!", 825, 200);
        ctx.fillText("If you get to 0 lives, it is game over!", 825, 225);
        ctx.fillText("There are 4 levels!", 825, 250);
        ctx.fillText("To increase a level, get two points!", 825, 275);
        ctx.closePath();
      }

      const end = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();        
        ctx.fillStyle = "black";
        ctx.font = "40px Times New Roman";
        ctx.fillText("Game over! Thanks for playing", 700, 150);
        ctx.closePath();
      }
      
      const drawObject = (object) => {
        if(object.name === "enemy") {
          ctx.drawImage(spike, object["x"], object["y"], object.width, object.height);
        }
        else if(object.name == "benefit") {
          ctx.drawImage(black_cat, object["x"], object["y"], object.width, object.height);
        }
        else {
          ctx.drawImage(tom, object["x"], object["y"], object.width, object.height);
        }
      }
      
      const reposition = (object) => {
        if(object["x"] >= canvas.width  + object["radius"]) {
          object["x"] = -object["radius"];
        }
      }
      
      //other is either the benefit or the harm character
      const hitDetection = (player, other) => {
//         var dx = player.x - other.x;
//         var dy = player.y - other.y;
//         var distance = Math.sqrt(dx * dx + dy * dy);
        
//         if (distance < player.radius + other.radius) {
//             if(other.name === "enemy") {
//               player.lives -= 1;
//             }
//             if(other.name === "benefit") {
//               player.score += 1;  
//             }
//             other.y = Math.floor(Math.random() * canvas.height);
//             //want the player to have some reaction
//             other.x = canvas.width - 600;
//         }
        
        if (player.x < other.x + other.width &&
           player.x + player.width > other.x &&
           player.y < other.y + other.height &&
           player.y + player.height > other.y) 
        {
          if(other.name === "enemy") {
            player.lives -= 1;
          }
          if(other.name === "benefit") {
            player.score += 1;  
          }
          other.y = Math.floor(Math.random() * canvas.height);
          //want the player to have some reaction
          other.x = canvas.width - 600;
        }
      }
      
      const drawInfo = () => {
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.font = "30px Times New Roman";
        ctx.fillText("Player Lives: " + player.lives, 30, 40, 1200);
        ctx.fillText("Player Score: " + player.score, 600, 40, 1200);
        ctx.fillText("Level: " + level, 1200, 40, 1200);
        ctx.closePath();
      }
      
      //clears the canvas
      //updates enemy and player characters
      const updateCanvas = () => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        enemy["x"] += enemy.speed;
        benefit["x"] += benefit.speed;
      }
      
      const changeLevel = () => {
        if(player.score >= baseThreshold && player.score % 2 == 0) {
          enemy.speed += 2;
          level++;
          baseThreshold += 2;
        }   
      }

      //score mod 100, game level property
      //level and speed, based on time, score
      const draw = () => {
        updateCanvas();

        reposition(enemy);
        reposition(benefit);

        drawObject(player);
        drawObject(enemy);
        drawObject(benefit);

        hitDetection(player, enemy);
        hitDetection(player, benefit);
                  
        changeLevel();

        drawInfo();
        
        if(player.lives > 0) {
          window.requestAnimationFrame(draw);
        }
        else {
          end();
        }
      }
      //use functions here
      start();
      
    </script>
</body>
</html>